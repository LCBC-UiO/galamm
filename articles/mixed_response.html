<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Models with Mixed Response Types ‚Ä¢ galamm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Models with Mixed Response Types">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">galamm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/galamm.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/lmm_factor.html">Linear Mixed Models with Factor Structures</a></li>
    <li><a class="dropdown-item" href="../articles/glmm_factor.html">Generalized Linear Mixed Models with Factor Structures</a></li>
    <li><a class="dropdown-item" href="../articles/lmm_heteroscedastic.html">Heteroscedastic Linear Mixed Models</a></li>
    <li><a class="dropdown-item" href="../articles/latent_observed_interaction.html">Interactions Between Latent and Observed Covariates</a></li>
    <li><a class="dropdown-item" href="../articles/mixed_response.html">Models with Mixed Response Types</a></li>
    <li><a class="dropdown-item" href="../articles/semiparametric.html">Semiparametric Latent Variable Modeling</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/scaling.html">Computational Scaling</a></li>
    <li><a class="dropdown-item" href="../articles/optimization.html">Optimization</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LCBC-UiO/galamm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Models with Mixed Response Types</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LCBC-UiO/galamm/blob/main/vignettes/mixed_response.Rmd" class="external-link"><code>vignettes/mixed_response.Rmd</code></a></small>
      <div class="d-none name"><code>mixed_response.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LCBC-UiO/galamm" class="external-link">galamm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette describes how <code>galamm</code> can be used to
estimate models with mixed response types.</p>
<div class="section level3">
<h3 id="mixed-normal-and-binomial-response">Mixed Normal and Binomial Response<a class="anchor" aria-label="anchor" href="#mixed-normal-and-binomial-response"></a>
</h3>
<p>We start with the <code>mresp</code> dataset, which comes with the
package. The variable ‚Äúitemgroup‚Äù defines the response type; it equals
‚Äúa‚Äù for normally distributed responses and ‚Äúb‚Äù for binomially
distributed responses. They are link through a common random
intercept.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mresp</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id         x        y.1        y.2 itemgroup</span></span>
<span><span class="co">#&gt; 1  1 0.8638214  0.2866329  1.0000000         a</span></span>
<span><span class="co">#&gt; 2  1 0.7676133  2.5647490  1.0000000         a</span></span>
<span><span class="co">#&gt; 3  1 0.8812059  1.0000000  2.0000000         b</span></span>
<span><span class="co">#&gt; 4  1 0.2239725  1.0000000  2.0000000         b</span></span>
<span><span class="co">#&gt; 5  2 0.7215696 -0.4721698  1.0000000         a</span></span>
<span><span class="co">#&gt; 6  2 0.6924851  1.1750286  1.0000000         a</span></span></code></pre></div>
<p>In terms of the GALAMM defined in the <a href="https://lcbc-uio.github.io/galamm/articles/galamm.html">introductory
vignette</a>, and for simplicity assuming we use canonical link
functions, we have the response model</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ŒΩ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mi>œï</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>ŒΩ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>‚àí</mo><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ŒΩ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>œï</mi></mfrac><mo>+</mo><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mi>œï</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
f\left(y_{ij} | \nu_{ij}, \phi\right) = \exp \left( \frac{y_{ij}\nu_{ij} - b\left(\nu_{ij}\right)}{\phi} + c\left(y_{ij}, \phi\right) \right)
</annotation></semantics></math></p>
<p>for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
observation of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
subject. Although we don‚Äôt show this with a subscript, when the variable
<code>itemgroup = "a"</code> we have a Gaussian response, so
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ŒΩ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>ŒΩ</mi><mn>2</mn></msup><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">b(\nu) = \nu^{2}/2</annotation></semantics></math>
and the support of the distribution is the entire real line
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>‚Ñù</mi><annotation encoding="application/x-tex">\mathbb{R}</annotation></semantics></math>.
The mean in this case is given by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>ŒΩ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mu_{ij} = \nu_{ij}</annotation></semantics></math>.
When <code>itemgroup = "b"</code> we have a binomial response, so
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ŒΩ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ŒΩ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">b(\nu) = \log(1 + \exp(\nu))</annotation></semantics></math>
and the support is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{0, 1\}</annotation></semantics></math>.
In this binomial case we also have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œï</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\phi=1</annotation></semantics></math>.
The mean in this case is given by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ŒΩ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ŒΩ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_{ij} = \exp(\nu_{ij}) / (1 + \exp(\nu_{ij}))</annotation></semantics></math>.
The function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mi>œï</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">c(y_{ij}, \phi)</annotation></semantics></math>
also differs between these cases, but is not of the same interest, since
it does not depend on the linear predictor. It hence matters for the
value of the log-likelihood, but not for its derivative with respect to
the parameters of interest.</p>
<p>Next, the nonlinear predictor is given by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ŒΩ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>Œ≤</mi><mn>0</mn></msub><mo>+</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>Œ≤</mi><mn>1</mn></msub><mo>+</mo><msubsup><mi>ùê≥</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>T</mi></msubsup><mi>ùõå</mi><mi>Œ∑</mi></mrow><annotation encoding="application/x-tex">\nu_{ij} = \beta_{0} + x_{ij}\beta_{1} + \mathbf{z}_{ij}^{T}\boldsymbol{\lambda} \eta</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">x_{ij}</annotation></semantics></math>
is an explanatory and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê≥</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mathbf{z}_{ij}</annotation></semantics></math>
is a dummy vector of length 2 with exactly one element equal to one and
one element equal to zero. When <code>itemgroup = "a"</code>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùê≥</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{z} = (1, 0)^{T}</annotation></semantics></math>
and when <code>itemgroup = "b"</code>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùê≥</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{z} = (0, 1)^{T}</annotation></semantics></math>.
The parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùõå</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\boldsymbol{\lambda} = (1, \lambda)^{T}</annotation></semantics></math>
is a vector of factor loadings, whose first element equals zero for
identifiability.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ∑</mi><annotation encoding="application/x-tex">\eta</annotation></semantics></math>
is a latent variable, in this case representing an underlying trait
‚Äúcausing‚Äù the observed responses.</p>
<p>The structural model is simply</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ∑</mi><mo>=</mo><mi>Œ∂</mi><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>œà</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\eta = \zeta \sim N(0, \psi),
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>œà</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N(0, \psi)</annotation></semantics></math>
denotes a normal distribution with mean 0 and variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œà</mi><annotation encoding="application/x-tex">\psi</annotation></semantics></math>.</p>
<p>We define the loading matrix as follows, where the value
<code>1</code> indicates that the first element
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõå</mi><annotation encoding="application/x-tex">\boldsymbol{\lambda}</annotation></semantics></math>
is fixed, and the value <code>NA</code> indicates that its second
element is unknown, and to be estimated.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">loading_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    1</span></span>
<span><span class="co">#&gt; [2,]   NA</span></span></code></pre></div>
<p>We set <code>load_var = "itemgroup"</code> because all rows of the
data with the same value of <code>itemgroup</code> will receive the same
factor loading. In <code>formula</code>, we state
<code>(0 + level | id)</code> to specify that each subject, identified
by <code>id</code>, has a given level. <code>level</code> is not an
element of the <code>mresp</code> data, but is instead the factor onto
which the loading matrix loads. We identify this with the argument
<code>factor = "level"</code>. We could have chosen any other name for
<code>"level"</code>, except for names that are already columns in
<code>mresp</code>.</p>
<p>We also need to define the response families using the
<code>gfam</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">families</span> <span class="op">&lt;-</span> <span class="fu">galamm</span><span class="fu">::</span><span class="fu"><a href="../reference/gfam.html">gfam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gaussian</span>, <span class="va">binomial</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We also need a way of telling galamm which row belongs to which
family. This is encoded in the dataframe <code>mresp</code>, where the
response <code>y</code> is a matrix with two columns, in which the first
column is the response and the second column is the index of the family.
That is, a <code>1</code> means <code>gaussian</code> and a
<code>2</code> means <code>binomial</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mresp</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  0.2866329    1</span></span>
<span><span class="co">#&gt; [2,]  2.5647490    1</span></span>
<span><span class="co">#&gt; [3,]  1.0000000    2</span></span>
<span><span class="co">#&gt; [4,]  1.0000000    2</span></span>
<span><span class="co">#&gt; [5,] -0.4721698    1</span></span>
<span><span class="co">#&gt; [6,]  1.1750286    1</span></span></code></pre></div>
<p>We are now ready to estimate the mixed response model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixed_resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galamm.html">galamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">level</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mresp</span>,</span>
<span>  family <span class="op">=</span> <span class="va">families</span>,</span>
<span>  load_var <span class="op">=</span> <span class="st">"itemgroup"</span>,</span>
<span>  lambda <span class="op">=</span> <span class="va">loading_matrix</span>,</span>
<span>  factor <span class="op">=</span> <span class="st">"level"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can also look at its summary output.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mixed_resp</span><span class="op">)</span></span>
<span><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span><span class="co">#&gt; Formula: y ~ x + (0 + level | id)</span></span>
<span><span class="co">#&gt;    Data: mresp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;   9248.7   9280.2  -4619.3   3633.1     3995 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Lambda:</span></span>
<span><span class="co">#&gt;         level      SE</span></span>
<span><span class="co">#&gt; lambda1 1.000       .</span></span>
<span><span class="co">#&gt; lambda2 1.095 0.09982</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups Name  Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  id     level 1.05     1.025   </span></span>
<span><span class="co">#&gt; Number of obs: 4000, groups:  id, 1000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value  Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept)    0.041    0.05803  0.7065 4.799e-01</span></span>
<span><span class="co">#&gt; x              0.971    0.08594 11.2994 1.321e-29</span></span></code></pre></div>
<div class="section level4">
<h4 id="mixed-response-and-heteroscedastic-residuals">Mixed Response and Heteroscedastic Residuals<a class="anchor" aria-label="anchor" href="#mixed-response-and-heteroscedastic-residuals"></a>
</h4>
<p>Mixed response models can be combined with heteroscedastic residuals,
which are described in the vignette on <a href="https://lcbc-uio.github.io/galamm/articles/lmm_heteroscedastic.html">linear
mixed models with heteroscedastic residuals</a>. However, some care is
needed in this case. We illustrate with the dataset
<code>mresp_hsced</code>, whose first few lines are shown below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mresp_hsced</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id         x         y.1         y.2 itemgroup grp isgauss</span></span>
<span><span class="co">#&gt; 1  1 0.8638214   0.2866329   1.0000000         a   b       1</span></span>
<span><span class="co">#&gt; 2  1 0.7676133   2.5647490   1.0000000         a   b       1</span></span>
<span><span class="co">#&gt; 3  1 0.8812059   1.0000000   2.0000000         b   b       0</span></span>
<span><span class="co">#&gt; 4  1 0.2239725   1.0000000   2.0000000         b   b       0</span></span>
<span><span class="co">#&gt; 5  2 0.7215696 -11.0020148   1.0000000         a   a       1</span></span>
<span><span class="co">#&gt; 6  2 0.6924851   1.1750286   1.0000000         a   b       1</span></span></code></pre></div>
<p>This dataset has the same structure as <code>mresp</code>, except
that the residual standard deviation of the normally distributed
responses vary according to the variable <code>grp</code>, which has two
levels. Two fit a model on this dataset with heteroscedastic residuals
for the normally distributed variable, we must use the dummy variable
<code>isgauss</code> when setting up the <code>weights</code>. This is
illustrated below. By writing <code>~ (0 + isgauss | grp)</code> we
specify that the heteroscedasticity is assumed between levels of
<code>grp</code>, but that this only applies when <code>isgauss</code>
is nonzero. Hence, the binomially distributed responses don‚Äôt have any
heteroscedastic residuals estimated, since for these observations the
dispersion parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œï</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is fixed to 1. We also ignore the factor loadings for simplicity.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galamm.html">galamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>  dispformula <span class="op">=</span> <span class="op">~</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">isgauss</span> <span class="op">|</span> <span class="va">grp</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">galamm</span><span class="fu">::</span><span class="fu"><a href="../reference/gfam.html">gfam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gaussian</span>, <span class="va">binomial</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mresp_hsced</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The summary output now shows that we also have estimated a variance
function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span><span class="co">#&gt; Formula: y ~ x + (1 | id)</span></span>
<span><span class="co">#&gt;    Data: mresp_hsced</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;  12356.9  12388.3  -6173.4  31426.4     3995 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups Name        Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  id     (Intercept) 0        0       </span></span>
<span><span class="co">#&gt; Number of obs: 4000, groups:  id, 1000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variance function:</span></span>
<span><span class="co">#&gt;       a       b </span></span>
<span><span class="co">#&gt; 1.00000 0.07756 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value  Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept)  0.01523    0.06303  0.2416 8.091e-01</span></span>
<span><span class="co">#&gt; x            0.99563    0.11153  8.9267 4.388e-19</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="covariate-measurement-error-model">Covariate Measurement Error Model<a class="anchor" aria-label="anchor" href="#covariate-measurement-error-model"></a>
</h3>
<p>This example is taken from Chapter 14.2 in <span class="citation">Skrondal and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>, and
follows the analyses in <span class="citation">(<a href="#ref-rabe-heskethCorrectingCovariateMeasurement2003">Rabe-Hesketh,
Pickles, and Skrondal 2003</a>; <a href="#ref-rabe-heskethMaximumLikelihoodEstimation2003">Rabe-Hesketh,
Skrondal, and Pickles 2003</a>)</span>. No originality is claimed with
respect to the analyses; but for the sake of understanding the
<code>galamm</code> code, we explain it in quite some detail. The
original dataset comes from <span class="citation">Morris, Marr, and
Clayton (<a href="#ref-morrisDietHeartPostscript1977">1977</a>)</span>.</p>
<p>The scientific question concerns the impact of fiber intake on risk
of coronary heat disease. 337 middle aged men were followed, all of whom
either worked as bank staff or as London Transport staff (indicated by
dummy variable <code>bus</code>). All men had a first measurement of
fiber intake, and some had an additional measurement six months later.
In addition, all had a binary variable indicating whether or not they
had developed coronary heart disease.</p>
<p>The first few rows of the dataset are printed below. All of these had
only a single measurement of fiber intake.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">diet</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id   age bus   item       y.1       y.2 chd fiber fiber2</span></span>
<span><span class="co">#&gt; 1  1 -0.38   1 fiber1 17.814280  1.000000   0     1      0</span></span>
<span><span class="co">#&gt; 2  1 -0.38   1    chd  0.000000  2.000000   1     0      0</span></span>
<span><span class="co">#&gt; 3  2  0.54   1 fiber1  9.487736  1.000000   0     1      0</span></span>
<span><span class="co">#&gt; 4  2  0.54   1    chd  0.000000  2.000000   1     0      0</span></span>
<span><span class="co">#&gt; 5  3  8.78   1 fiber1 15.958630  1.000000   0     1      0</span></span>
<span><span class="co">#&gt; 6  3  8.78   1    chd  0.000000  2.000000   1     0      0</span></span></code></pre></div>
<p>It is instructive to also look at some men who had two measurements
of fiber intake. Here are three of them.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diet</span><span class="op">[</span><span class="va">diet</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">219</span>, <span class="fl">220</span>, <span class="fl">221</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;      id   age bus   item      y.1      y.2 chd fiber fiber2</span></span>
<span><span class="co">#&gt; 429 219 -8.13   0 fiber1 15.64263  1.00000   0     1      0</span></span>
<span><span class="co">#&gt; 430 219 -8.13   0 fiber2 14.87973  1.00000   0     1      1</span></span>
<span><span class="co">#&gt; 431 219 -8.13   0    chd  0.00000  2.00000   1     0      0</span></span>
<span><span class="co">#&gt; 432 220 -1.13   0 fiber1 13.46374  1.00000   0     1      0</span></span>
<span><span class="co">#&gt; 433 220 -1.13   0 fiber2 14.73168  1.00000   0     1      1</span></span>
<span><span class="co">#&gt; 434 220 -1.13   0    chd  0.00000  2.00000   1     0      0</span></span>
<span><span class="co">#&gt; 435 221  3.67   0 fiber1 15.95863  1.00000   0     1      0</span></span>
<span><span class="co">#&gt; 436 221  3.67   0 fiber2 17.28778  1.00000   0     1      1</span></span>
<span><span class="co">#&gt; 437 221  3.67   0    chd  0.00000  2.00000   1     0      0</span></span></code></pre></div>
<div class="section level4">
<h4 id="structural-model">Structural Model<a class="anchor" aria-label="anchor" href="#structural-model"></a>
</h4>
<p>Our first goal is to model the effect of fiber intake on risk of
heart disease. Since this variable is very likely to be subject to
measurement error, it is well known that simply averaging the two
measurements, where available, and using the single measurement
otherwise, will lead to bias and lack of power <span class="citation">(<a href="#ref-carrollMeasurementErrorNonlinear2006">Carroll et al.
2006</a>)</span>. Instead, we let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∑</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\eta_{j}</annotation></semantics></math>
denote the true (latent) fiber intake of person
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
and define the structural model</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∑</mi><mi>j</mi></msub><mo>=</mo><msub><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>‚Ä≤</mi><mi>ùõÑ</mi><mo>+</mo><msub><mi>Œ∂</mi><mi>j</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\eta_{j} = \mathbf{x}_{ij}'\boldsymbol{\gamma} + \zeta_{j}.</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mathbf{x}_{ij}</annotation></semantics></math>
is a vector of covariates age, bus, and their interaction, as well as a
constant term for defining the intercept. The R formula for setting up
the model matrix would be
<code>model.matrix(~ age * bus, data = diet)</code>. The term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∂</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\zeta_{j}</annotation></semantics></math>
is a normally distributed disturbance,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∂</mi><mi>j</mi></msub><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>œà</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\zeta_{j} \sim N(0, \psi)</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="measurement-model">Measurement Model<a class="anchor" aria-label="anchor" href="#measurement-model"></a>
</h4>
<p>It is assumed that the fiber measurements are normally distributed
around the true value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∑</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\eta_{j}</annotation></semantics></math>,
and allow for a drift term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>Œ≤</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">d_{ij}\beta_{0}</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mrow><mn>2</mn><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">d_{2ij}</annotation></semantics></math>
is a dummy variable whose value equals one if the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
row of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>th
person is a replicate fiber measurement, and zero otherwise. This allows
for a drift in the measurements, and the model becomes</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>d</mi><mrow><mn>2</mn><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>Œ≤</mi><mn>0</mn></msub><mo>+</mo><msub><mi>Œ∑</mi><mi>j</mi></msub><mo>+</mo><msub><mi>œµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mspace width="2.0em"></mspace><msub><mi>œµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">y_{ij} = d_{2ij} \beta_{0} + \eta_{j} + \epsilon_{ij}, \qquad \epsilon_{ij} = N(0, \theta).</annotation></semantics></math></p>
</div>
<div class="section level4">
<h4 id="disease-model">Disease Model<a class="anchor" aria-label="anchor" href="#disease-model"></a>
</h4>
<p>Next, for the rows corresponding to coronary heart disease
measurement, we assume a binomial model with a logit link function,
i.e., logistic regression. This model is given by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">logit</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>Œ∑</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>‚Ä≤</mi><mi>ùõÉ</mi><mo>+</mo><mi>Œª</mi><msub><mi>Œ∑</mi><mi>j</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">\text{logit}[P(y_{ij}=1 | \eta_{j})] = \mathbf{x}_{ij}'\boldsymbol{\beta} + \lambda \eta_{j},</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mathbf{x}_{ij}</annotation></semantics></math>
is the same as before, but where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõÉ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
now represents the direct effect of age and bus on the probability of
coronary heart disease. The factor loading
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
is the regression coefficient for latent fiber intake on the risk of
coronary heart disease.</p>
</div>
<div class="section level4">
<h4 id="nonlinear-predictor">Nonlinear Predictor<a class="anchor" aria-label="anchor" href="#nonlinear-predictor"></a>
</h4>
<p>Stacking the three responses, which are fiber intake at times 1 and
2, and coronary heart disease, we can define the joint model as a GLLAMM
with nonlinear predictor</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ŒΩ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>d</mi><mrow><mn>2</mn><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>Œ≤</mi><mn>0</mn></msub><mo>+</mo><msub><mi>d</mi><mrow><mn>3</mn><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>ùê±</mi><mi>j</mi></msub><mi>‚Ä≤</mi><mi>ùõÉ</mi><mo>+</mo><msub><mi>ùê±</mi><mi>j</mi></msub><mi>‚Ä≤</mi><mi>ùõÑ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>d</mi><mrow><mn>1</mn><mi>i</mi></mrow></msub><mo>+</mo><msub><mi>d</mi><mrow><mn>2</mn><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>Œª</mi><msub><mi>d</mi><mrow><mn>3</mn><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><msub><mi>Œ∂</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>d</mi><mrow><mn>1</mn><mi>i</mi></mrow></msub><mo>+</mo><msub><mi>d</mi><mrow><mn>2</mn><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>Œª</mi><msub><mi>d</mi><mrow><mn>3</mn><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\nu_{ij} = d_{2ij} \beta_{0} + d_{3ij} \mathbf{x}_{j}'\boldsymbol{\beta} + \mathbf{x}_{j}'\boldsymbol{\gamma}\left[(d_{1i} + d_{2i}) + \lambda d_{3i}\right] + \zeta_{j} \left[(d_{1i} + d_{2i}) + \lambda d_{3i}\right],</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mrow><mn>1</mn><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">d_{1i}</annotation></semantics></math>
is a dummy variable for fiber measurements at timepoint 1 and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mrow><mn>3</mn><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">d_{3i}</annotation></semantics></math>
is an indicator for coronary heart disease.</p>
</div>
<div class="section level4">
<h4 id="estimating-the-model-with-galamm">Estimating the Model with galamm<a class="anchor" aria-label="anchor" href="#estimating-the-model-with-galamm"></a>
</h4>
<p>In the measurement model for fiber above, note that we implicitly
have factor loadings equal to one. Letting the <code>item</code>
variable define which rows should receive which loading, we note that
the factor levels are as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">diet</span><span class="op">$</span><span class="va">item</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "fiber1" "fiber2" "chd"</span></span></code></pre></div>
<p>We could of course have changed this, but given these levels, we
define the following loading matrix:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">loading_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    1</span></span>
<span><span class="co">#&gt; [2,]    1</span></span>
<span><span class="co">#&gt; [3,]   NA</span></span></code></pre></div>
<p>That is, ‚Äúfiber1‚Äù and ‚Äúfiber2‚Äù receive a loading fixed to one,
whereas the loading for ‚Äúchd‚Äù remains to be estimated.</p>
<p>We also need to define the families, making sure it is binomial for
‚Äúchd‚Äù and Gaussian for ‚Äúfiber1‚Äù and ‚Äúfiber2‚Äù.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">diet</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 17.814280    1</span></span>
<span><span class="co">#&gt; [2,]  0.000000    2</span></span>
<span><span class="co">#&gt; [3,]  9.487736    1</span></span>
<span><span class="co">#&gt; [4,]  0.000000    2</span></span>
<span><span class="co">#&gt; [5,] 15.958630    1</span></span>
<span><span class="co">#&gt; [6,]  0.000000    2</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">families</span> <span class="op">&lt;-</span> <span class="fu">galamm</span><span class="fu">::</span><span class="fu"><a href="../reference/gfam.html">gfam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gaussian</span>, <span class="va">binomial</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The model formula also needs some care in this case. We define it as
follows, and note that the whole part
<code>0 + chd + fiber + fiber2</code> could have been replaced by
<code>item</code>. We use the former for ease of explanation.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">chd</span> <span class="op">+</span> <span class="op">(</span><span class="va">age</span> <span class="op">*</span> <span class="va">bus</span><span class="op">)</span><span class="op">:</span><span class="va">chd</span> <span class="op">+</span> <span class="va">fiber</span> <span class="op">+</span></span>
<span>  <span class="op">(</span><span class="va">age</span> <span class="op">*</span> <span class="va">bus</span><span class="op">)</span><span class="op">:</span><span class="va">fiber</span> <span class="op">+</span> <span class="va">fiber2</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">loading</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span></code></pre></div>
<p>The initial zero specifies that we don‚Äôt want R to insert an
intercept term. Next, <code>chd + (age * bus) : chd</code> applies to
‚Äúchd‚Äù rows only, and corresponds to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>T</mi></msubsup><mi>ùõÉ</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}_{ij}^{T} \boldsymbol{\beta}</annotation></semantics></math>
in the disease model. The part <code>fiber + (age * bus) : fiber</code>
corresponds to the term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>ùê±</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>T</mi></msubsup><mi>ùõÑ</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}_{ij}^{T}\boldsymbol{\gamma}</annotation></semantics></math>
in the disease model, and <code>fiber2</code> corresponds to the drift
term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mn>2</mn><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>Œ≤</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">d_{2ij}\beta_{0}</annotation></semantics></math>.</p>
<p>We can inspect the model implied by the formula by using the
<code>nobars</code> function from <a href="https://cran.r-project.org/package=lme4" class="external-link">lme4</a> <span class="citation">(<a href="#ref-batesFittingLinearMixedEffects2015">Bates et al.
2015</a>)</span> to remove the random effects, and then
<code>model.matrix</code>. It looks correctly set up.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="fu">nobars</span><span class="op">(</span><span class="va">formula</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">diet</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   chd fiber fiber2 chd:age chd:bus age:fiber bus:fiber chd:age:bus age:bus:fiber</span></span>
<span><span class="co">#&gt; 1   0     1      0    0.00       0     -0.38         1        0.00         -0.38</span></span>
<span><span class="co">#&gt; 2   1     0      0   -0.38       1      0.00         0       -0.38          0.00</span></span>
<span><span class="co">#&gt; 3   0     1      0    0.00       0      0.54         1        0.00          0.54</span></span>
<span><span class="co">#&gt; 4   1     0      0    0.54       1      0.00         0        0.54          0.00</span></span>
<span><span class="co">#&gt; 5   0     1      0    0.00       0      8.78         1        0.00          8.78</span></span>
<span><span class="co">#&gt; 6   1     0      0    8.78       1      0.00         0        8.78          0.00</span></span></code></pre></div>
<p>Finally, the random effects part <code>(0 + loading | id)</code>
specifies that for each <code>id</code> there should be a single random
intercept, which corresponds to latent fiber intake
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∑</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\eta_{j}</annotation></semantics></math>.
Writing <code>0 + loading</code> means that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∑</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\eta_{j}</annotation></semantics></math>
should be multiplied by the factor loadings defined in the loading
matrix.</p>
<p>We are now ready to fit the model.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galamm.html">galamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">diet</span>,</span>
<span>  family <span class="op">=</span> <span class="va">families</span>,</span>
<span>  factor <span class="op">=</span> <span class="st">"loading"</span>,</span>
<span>  load_var <span class="op">=</span> <span class="st">"item"</span>,</span>
<span>  lambda <span class="op">=</span> <span class="va">loading_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Looking at the summary output, however, we see a warning that the
Hessian matrix is rank deficient.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in vcov.galamm(object, parm = "lambda"): Rank deficient Hessian matrix.Could not compute covariance matrix.</span></span>
<span><span class="co">#&gt; Warning in vcov.galamm(object, "beta"): Rank deficient Hessian matrix.Could not compute covariance matrix.</span></span>
<span><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span><span class="co">#&gt; Formula: formula</span></span>
<span><span class="co">#&gt;    Data: diet</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;   2837.6   2892.9  -1406.8  12529.3      730 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Lambda:</span></span>
<span><span class="co">#&gt;         loading SE</span></span>
<span><span class="co">#&gt; lambda1   1.000  .</span></span>
<span><span class="co">#&gt; lambda2   1.000  .</span></span>
<span><span class="co">#&gt; lambda3  -2.026  .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups Name    Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  id     loading 0        0       </span></span>
<span><span class="co">#&gt; Number of obs: 742, groups:  id, 333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; chd           -1.78692         NA      NA       NA</span></span>
<span><span class="co">#&gt; fiber         17.96184         NA      NA       NA</span></span>
<span><span class="co">#&gt; fiber2        -0.64927         NA      NA       NA</span></span>
<span><span class="co">#&gt; chd:age        0.06682         NA      NA       NA</span></span>
<span><span class="co">#&gt; chd:bus       -0.06882         NA      NA       NA</span></span>
<span><span class="co">#&gt; fiber:age     -0.20480         NA      NA       NA</span></span>
<span><span class="co">#&gt; fiber:bus     -1.69601         NA      NA       NA</span></span>
<span><span class="co">#&gt; chd:age:bus   -0.04934         NA      NA       NA</span></span>
<span><span class="co">#&gt; fiber:age:bus  0.16097         NA      NA       NA</span></span></code></pre></div>
<p>We suspect that this is a convergence issue of the algorithm, and
start by simply turning a lever to make the algorithm more verbose. The
argument <code>trace = 3</code> is passed onto <code>optim</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galamm.html">galamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">diet</span>,</span>
<span>  family <span class="op">=</span> <span class="va">families</span>,</span>
<span>  factor <span class="op">=</span> <span class="st">"loading"</span>,</span>
<span>  load_var <span class="op">=</span> <span class="st">"item"</span>,</span>
<span>  lambda <span class="op">=</span> <span class="va">loading_matrix</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="../reference/galamm_control.html">galamm_control</a></span><span class="op">(</span>optim_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; N = 11, M = 20 machine precision = 2.22045e-16</span></span>
<span><span class="co">#&gt; At X0, 0 variables are exactly at the bounds</span></span>
<span><span class="co">#&gt; At iterate     0  f=         2148  |proj g|=       122.68</span></span>
<span><span class="co">#&gt; At iterate    10  f =       1770.3  |proj g|=        30.656</span></span>
<span><span class="co">#&gt; At iterate    20  f =       1467.2  |proj g|=        11.286</span></span>
<span><span class="co">#&gt; At iterate    30  f =       1417.6  |proj g|=        73.904</span></span>
<span><span class="co">#&gt; At iterate    40  f =       1406.8  |proj g|=       0.21144</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; iterations 43</span></span>
<span><span class="co">#&gt; function evaluations 51</span></span>
<span><span class="co">#&gt; segments explored during Cauchy searches 44</span></span>
<span><span class="co">#&gt; BFGS updates skipped 0</span></span>
<span><span class="co">#&gt; active bounds at final generalized Cauchy point 1</span></span>
<span><span class="co">#&gt; norm of the final projected gradient 0.0123301</span></span>
<span><span class="co">#&gt; final function value 1406.8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; F = 1406.8</span></span>
<span><span class="co">#&gt; final  value 1406.801105 </span></span>
<span><span class="co">#&gt; converged</span></span></code></pre></div>
<p>Now we got some information, but the final estimate is the same,
since we otherwise used the same parameters. We now instead try to
increase the initial estimate of the random effect parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ∏</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>.
In general
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ∏</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
is a vector containing elements of the Cholesky factor of the covariance
matrix (see, <span class="citation">Bates et al. (<a href="#ref-batesFittingLinearMixedEffects2015">2015</a>)</span>), but in
this case it is just the standard deviation of the latent variable. By
default, its initial value is 1, but we now try to increase it to 10,
with the <code>start</code> argument.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galamm.html">galamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">diet</span>,</span>
<span>  family <span class="op">=</span> <span class="va">families</span>,</span>
<span>  factor <span class="op">=</span> <span class="st">"loading"</span>,</span>
<span>  load_var <span class="op">=</span> <span class="st">"item"</span>,</span>
<span>  lambda <span class="op">=</span> <span class="va">loading_matrix</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="../reference/galamm_control.html">galamm_control</a></span><span class="op">(</span>optim_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; N = 11, M = 20 machine precision = 2.22045e-16</span></span>
<span><span class="co">#&gt; At X0, 0 variables are exactly at the bounds</span></span>
<span><span class="co">#&gt; At iterate     0  f=       2827.6  |proj g|=       123.31</span></span>
<span><span class="co">#&gt; At iterate    10  f =       1764.5  |proj g|=        103.86</span></span>
<span><span class="co">#&gt; At iterate    20  f =       1623.6  |proj g|=        131.81</span></span>
<span><span class="co">#&gt; At iterate    30  f =       1442.4  |proj g|=        35.169</span></span>
<span><span class="co">#&gt; At iterate    40  f =         1388  |proj g|=        20.654</span></span>
<span><span class="co">#&gt; At iterate    50  f =       1372.4  |proj g|=        1.4042</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; iterations 57</span></span>
<span><span class="co">#&gt; function evaluations 69</span></span>
<span><span class="co">#&gt; segments explored during Cauchy searches 58</span></span>
<span><span class="co">#&gt; BFGS updates skipped 0</span></span>
<span><span class="co">#&gt; active bounds at final generalized Cauchy point 0</span></span>
<span><span class="co">#&gt; norm of the final projected gradient 0.0119116</span></span>
<span><span class="co">#&gt; final function value 1372.16</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; F = 1372.16</span></span>
<span><span class="co">#&gt; final  value 1372.160387 </span></span>
<span><span class="co">#&gt; converged</span></span></code></pre></div>
<p>The output printed is the negative log-likelihood, and since 1372.16
is less than 1406.8, increasing the initial value to 10 led us to a
local optimum with higher likelihood value. Ideally we should have tried
other initial values as well, but since <span class="citation">Skrondal
and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>
obtained a negative log-likelihood value of 1372.35 while using adaptive
quadrature estimation, we are pretty happy about finding a value close
to theirs.</p>
<p>We can now use the summary method, where we find that our estimates
are very close to the corresponding model in Table 14.1 of <span class="citation">Skrondal and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span><span class="co">#&gt; Formula: formula</span></span>
<span><span class="co">#&gt;    Data: diet</span></span>
<span><span class="co">#&gt; Control: galamm_control(optim_control = list(trace = 3))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;   2768.3   2823.6  -1372.2   2002.9      730 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Lambda:</span></span>
<span><span class="co">#&gt;         loading      SE</span></span>
<span><span class="co">#&gt; lambda1  1.0000       .</span></span>
<span><span class="co">#&gt; lambda2  1.0000       .</span></span>
<span><span class="co">#&gt; lambda3 -0.1339 0.05121</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups Name    Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  id     loading 23.64    4.862   </span></span>
<span><span class="co">#&gt; Number of obs: 742, groups:  id, 333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error  z value   Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; chd           -1.91520    0.27229 -7.03361  2.013e-12</span></span>
<span><span class="co">#&gt; fiber         17.94834    0.48686 36.86566 1.641e-297</span></span>
<span><span class="co">#&gt; fiber2         0.22406    0.41783  0.53624  5.918e-01</span></span>
<span><span class="co">#&gt; chd:age        0.06613    0.05931  1.11515  2.648e-01</span></span>
<span><span class="co">#&gt; chd:bus       -0.02900    0.34355 -0.08441  9.327e-01</span></span>
<span><span class="co">#&gt; fiber:age     -0.21207    0.10090 -2.10172  3.558e-02</span></span>
<span><span class="co">#&gt; fiber:bus     -1.68278    0.63721 -2.64084  8.270e-03</span></span>
<span><span class="co">#&gt; chd:age:bus   -0.04998    0.06507 -0.76812  4.424e-01</span></span>
<span><span class="co">#&gt; fiber:age:bus  0.16821    0.11223  1.49882  1.339e-01</span></span></code></pre></div>
<p>Now we were able to reproduce results very close to those in Table
14.1 on page 420 of <span class="citation">Skrondal and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>. This
is a useful assurance that the algorithm used by galamm is correctly
implemented.</p>
</div>
<div class="section level4">
<h4 id="comparison-to-a-model-with-indirect-effect-only">Comparison to a Model with Indirect Effect Only<a class="anchor" aria-label="anchor" href="#comparison-to-a-model-with-indirect-effect-only"></a>
</h4>
<p>The model above assumed that the age and bus variables had both an
indirect effect on the risk of coronary heart disease through its impact
on fiber intake, as well as a direct effect. Still following <span class="citation">Skrondal and Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>, we
now estimate an alternative model which only has indirect effects. The
disease model is now</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">logit</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>Œ∑</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi><mn>3</mn></mrow></msub><msub><mi>Œ≤</mi><mn>03</mn></msub><mo>+</mo><mi>Œª</mi><msub><mi>Œ∑</mi><mi>j</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
\text{logit}[P(y_{ij}=1 | \eta_{j})] = d_{ij3}\beta_{03} + \lambda \eta_{j},
</annotation></semantics></math></p>
<p>The formula becomes</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula0</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">chd</span> <span class="op">+</span> <span class="va">fiber</span> <span class="op">+</span> <span class="op">(</span><span class="va">age</span> <span class="op">*</span> <span class="va">bus</span><span class="op">)</span><span class="op">:</span><span class="va">fiber</span> <span class="op">+</span> <span class="va">fiber2</span> <span class="op">+</span></span>
<span>  <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">loading</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span></code></pre></div>
<p>Everything else is the same as before, so we fit the new model
with</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/galamm.html">galamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">formula0</span>,</span>
<span>  data <span class="op">=</span> <span class="va">diet</span>,</span>
<span>  family <span class="op">=</span> <span class="va">families</span>,</span>
<span>  factor <span class="op">=</span> <span class="st">"loading"</span>,</span>
<span>  load_var <span class="op">=</span> <span class="st">"item"</span>,</span>
<span>  lambda <span class="op">=</span> <span class="va">loading_matrix</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="../reference/galamm_control.html">galamm_control</a></span><span class="op">(</span>optim_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; N = 8, M = 20 machine precision = 2.22045e-16</span></span>
<span><span class="co">#&gt; At X0, 0 variables are exactly at the bounds</span></span>
<span><span class="co">#&gt; At iterate     0  f=       2827.6  |proj g|=       123.31</span></span>
<span><span class="co">#&gt; At iterate    10  f =       1664.7  |proj g|=        25.235</span></span>
<span><span class="co">#&gt; At iterate    20  f =       1427.9  |proj g|=        37.186</span></span>
<span><span class="co">#&gt; At iterate    30  f =       1373.5  |proj g|=        5.1449</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; iterations 37</span></span>
<span><span class="co">#&gt; function evaluations 40</span></span>
<span><span class="co">#&gt; segments explored during Cauchy searches 38</span></span>
<span><span class="co">#&gt; BFGS updates skipped 0</span></span>
<span><span class="co">#&gt; active bounds at final generalized Cauchy point 0</span></span>
<span><span class="co">#&gt; norm of the final projected gradient 0.000304544</span></span>
<span><span class="co">#&gt; final function value 1373.01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; F = 1373.01</span></span>
<span><span class="co">#&gt; final  value 1373.013263 </span></span>
<span><span class="co">#&gt; converged</span></span></code></pre></div>
<p>Looking at the summary output, the estimates are now close to the
first column in Table 14.1 of <span class="citation">Skrondal and
Rabe-Hesketh (<a href="#ref-skrondalGeneralizedLatentVariable2004">2004</a>)</span>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod0</span><span class="op">)</span></span>
<span><span class="co">#&gt; GALAMM fit by maximum marginal likelihood.</span></span>
<span><span class="co">#&gt; Formula: formula0</span></span>
<span><span class="co">#&gt;    Data: diet</span></span>
<span><span class="co">#&gt; Control: galamm_control(optim_control = list(trace = 3))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;   2764.0   2805.5  -1373.0   2007.9      733 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Lambda:</span></span>
<span><span class="co">#&gt;         loading      SE</span></span>
<span><span class="co">#&gt; lambda1   1.000       .</span></span>
<span><span class="co">#&gt; lambda2   1.000       .</span></span>
<span><span class="co">#&gt; lambda3  -0.136 0.05148</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups Name    Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  id     loading 23.64    4.862   </span></span>
<span><span class="co">#&gt; Number of obs: 742, groups:  id, 333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error  z value   Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; chd            -1.9668    0.18248 -10.7783  4.360e-27</span></span>
<span><span class="co">#&gt; fiber          17.9741    0.48123  37.3504 2.502e-305</span></span>
<span><span class="co">#&gt; fiber2          0.2238    0.41779   0.5358  5.921e-01</span></span>
<span><span class="co">#&gt; fiber:age      -0.1896    0.09914  -1.9122  5.585e-02</span></span>
<span><span class="co">#&gt; fiber:bus      -1.6991    0.62529  -2.7173  6.581e-03</span></span>
<span><span class="co">#&gt; fiber:age:bus   0.1515    0.11012   1.3760  1.688e-01</span></span></code></pre></div>
<p>We can use <code>anova</code> method for galamm objects to compare
the models. AIC and BIC favor the simpler model with only indirect
effects.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">mod0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Data: diet</span></span>
<span><span class="co">#&gt; Models:</span></span>
<span><span class="co">#&gt; mod0: formula0</span></span>
<span><span class="co">#&gt; mod: formula</span></span>
<span><span class="co">#&gt;      npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)</span></span>
<span><span class="co">#&gt; mod0    9 2764.0 2805.5 -1373.0   2002.9                     </span></span>
<span><span class="co">#&gt; mod    12 2768.3 2823.6 -1372.2   2002.9 1.7058  3     0.6357</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-batesFittingLinearMixedEffects2015" class="csl-entry">
Bates, Douglas M, Martin M√§chler, Ben Bolker, and Steve Walker. 2015.
<span>‚ÄúFitting <span>Linear Mixed-Effects Models Using</span>
Lme4.‚Äù</span> <em>Journal of Statistical Software</em> 67 (1): 1‚Äì48. <a href="https://doi.org/10.18637/jss.v067.i01" class="external-link">https://doi.org/10.18637/jss.v067.i01</a>.
</div>
<div id="ref-carrollMeasurementErrorNonlinear2006" class="csl-entry">
Carroll, Raymond J., David Ruppert, Leonard A. Stefanski, and Ciprian M.
Crainiceanu. 2006. <em>Measurement <span>Error</span> in <span>Nonlinear
Models</span>: <span>A Modern Perspective</span></em>. 2nd ed.
Monographs on <span>Statistics</span> and <span>Applied
Probability</span>. Boca Raton, Florida: John Wiley &amp; Sons.
</div>
<div id="ref-morrisDietHeartPostscript1977" class="csl-entry">
Morris, J. N., J. W. Marr, and D. G. Clayton. 1977. <span>‚ÄúDiet and
Heart: A Postscript.‚Äù</span> <em>Br Med J</em> 2 (6098): 1307‚Äì14. <a href="https://doi.org/10.1136/bmj.2.6098.1307" class="external-link">https://doi.org/10.1136/bmj.2.6098.1307</a>.
</div>
<div id="ref-rabe-heskethCorrectingCovariateMeasurement2003" class="csl-entry">
Rabe-Hesketh, Sophia, Andrew Pickles, and Anders Skrondal. 2003.
<span>‚ÄúCorrecting for Covariate Measurement Error in Logistic Regression
Using Nonparametric Maximum Likelihood Estimation.‚Äù</span>
<em>Statistical Modelling</em> 3 (3): 215‚Äì32. <a href="https://doi.org/10.1191/1471082X03st056oa" class="external-link">https://doi.org/10.1191/1471082X03st056oa</a>.
</div>
<div id="ref-rabe-heskethMaximumLikelihoodEstimation2003" class="csl-entry">
Rabe-Hesketh, Sophia, Anders Skrondal, and Andrew Pickles. 2003.
<span>‚ÄúMaximum <span>Likelihood Estimation</span> of <span>Generalized
Linear Models</span> with <span>Covariate Measurement
Error</span>.‚Äù</span> <em>The Stata Journal</em> 3 (4): 386‚Äì411. <a href="https://doi.org/10.1177/1536867X0400300408" class="external-link">https://doi.org/10.1177/1536867X0400300408</a>.
</div>
<div id="ref-skrondalGeneralizedLatentVariable2004" class="csl-entry">
Skrondal, Anders, and Sophia Rabe-Hesketh. 2004. <em>Generalized Latent
Variable Modeling</em>. Interdisciplinary <span>Statistics
Series</span>. Boca Raton, Florida: <span>Chapman and Hall/CRC</span>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by √òystein S√∏rensen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
