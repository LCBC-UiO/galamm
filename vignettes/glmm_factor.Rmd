---
title: "Generalized Linear Mixed Models with Factor Structures"
output: rmarkdown::html_vignette
bibliography: ../inst/references.bib
vignette: >
  %\VignetteIndexEntry{Linear Mixed Models with Factor Structures}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(galamm)
library(PLmixed)
```

This vignette describes how `galamm` can be used to estimate generalized linear mixed models with factor structures. Such models are an instance of the generalized linear latent and mixed models (GLLAMM) framework described by @rabe-heskethGeneralizedMultilevelStructural2004. The R package `PLmixed` [@rockwoodEstimatingComplexMeasurement2019] estimates such models using a profile likelihood algorithm initially proposed by @jeonProfileLikelihoodApproachEstimating2012. The models are also a special case of generalized additive latent and mixed models (GALAMM), and in `galamm` these models are estimated using a more direct algorithm described in @sorensenLongitudinalModelingAgeDependent2023.

As for the vignette on linear mixed models, we thank @rockwoodEstimatingComplexMeasurement2019 for creating the `PLmixed` package, from which we take example datasets, and on which we have based the formula syntax of `galamm`.

## Model with Binomially Distributed Responses

We use a simulated dataset from the `PLmixed` package for the example in this vignette. In the vignette on linear mixed models with factor structures, the response was treated as Gaussian. Here we use the more appropriate assumption that the response is binomially distributed.

First we set up the factor structures to be used:

```{r}
data("IRTsim")
IRTsim$item <- factor(IRTsim$item)
irt.lam <- matrix(c(1, NA, NA, NA, NA), ncol = 1)
```

We fit the model as follows:

```{r}
galamm_mod <- galamm(
  formula = y ~ item + (0 + abil.sid | sid) + (0 + abil.sid | school),
  data = IRTsim, 
  family = binomial,
  load.var = "item", 
  factor = list("abil.sid"), 
  lambda = list(irt.lam)
  )

summary(galamm_mod)
```




# References
