<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a generalized additive latent and mixed model — galamm • galamm</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a generalized additive latent and mixed model — galamm"><meta name="description" content="This function fits a generalized additive latent and mixed model
(GALAMMs), as described in
Sørensen et al. (2023)
.
The building blocks of these models are generalized additive mixed models
(GAMMs) (Wood 2017)
, of which
generalized linear mixed models
(Breslow and Clayton 1993; Harville 1977; Henderson 1975; Laird and Ware 1982)

are special cases. GALAMMs extend upon GAMMs by allowing factor structures,
as commonly used to model hypothesized latent traits underlying observed
measurements. In this sense, GALAMMs are an extension of generalized linear
latent and mixed models (GLLAMMs)
(Skrondal and Rabe-Hesketh 2004; Rabe-Hesketh et al. 2004)

which allows semiparametric estimation. The implemented algorithm used to
compute model estimates is described in
Sørensen et al. (2023)
,
and is an extension of the algorithm used for fitting generalized linear
mixed models by the lme4 package
(Bates et al. 2015)
. The syntax used to
define factor structures is based on that used by the PLmixed
package, which is detailed in
Rockwood and Jeon (2019)
."><meta property="og:description" content="This function fits a generalized additive latent and mixed model
(GALAMMs), as described in
Sørensen et al. (2023)
.
The building blocks of these models are generalized additive mixed models
(GAMMs) (Wood 2017)
, of which
generalized linear mixed models
(Breslow and Clayton 1993; Harville 1977; Henderson 1975; Laird and Ware 1982)

are special cases. GALAMMs extend upon GAMMs by allowing factor structures,
as commonly used to model hypothesized latent traits underlying observed
measurements. In this sense, GALAMMs are an extension of generalized linear
latent and mixed models (GLLAMMs)
(Skrondal and Rabe-Hesketh 2004; Rabe-Hesketh et al. 2004)

which allows semiparametric estimation. The implemented algorithm used to
compute model estimates is described in
Sørensen et al. (2023)
,
and is an extension of the algorithm used for fitting generalized linear
mixed models by the lme4 package
(Bates et al. 2015)
. The syntax used to
define factor structures is based on that used by the PLmixed
package, which is detailed in
Rockwood and Jeon (2019)
."><meta property="og:image" content="https://lcbc-uio.github.io/galamm/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">galamm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/galamm.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/lmm_factor.html">Linear Mixed Models with Factor Structures</a></li>
    <li><a class="dropdown-item" href="../articles/glmm_factor.html">Generalized Linear Mixed Models with Factor Structures</a></li>
    <li><a class="dropdown-item" href="../articles/lmm_heteroscedastic.html">Heteroscedastic Linear Mixed Models</a></li>
    <li><a class="dropdown-item" href="../articles/latent_observed_interaction.html">Interactions Between Latent and Observed Covariates</a></li>
    <li><a class="dropdown-item" href="../articles/mixed_response.html">Models with Mixed Response Types</a></li>
    <li><a class="dropdown-item" href="../articles/semiparametric.html">Semiparametric Latent Variable Modeling</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/scaling.html">Computational Scaling</a></li>
    <li><a class="dropdown-item" href="../articles/optimization.html">Optimization</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LCBC-UiO/galamm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fit a generalized additive latent and mixed model</h1>
      <small class="dont-index">Source: <a href="https://github.com/LCBC-UiO/galamm/blob/v0.2.1/R/galamm.R" class="external-link"><code>R/galamm.R</code></a></small>
      <div class="d-none name"><code>galamm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function fits a generalized additive latent and mixed model
(GALAMMs), as described in
Sørensen et al. (2023)
.
The building blocks of these models are generalized additive mixed models
(GAMMs) (Wood 2017)
, of which
generalized linear mixed models
(Breslow and Clayton 1993; Harville 1977; Henderson 1975; Laird and Ware 1982)

are special cases. GALAMMs extend upon GAMMs by allowing factor structures,
as commonly used to model hypothesized latent traits underlying observed
measurements. In this sense, GALAMMs are an extension of generalized linear
latent and mixed models (GLLAMMs)
(Skrondal and Rabe-Hesketh 2004; Rabe-Hesketh et al. 2004)

which allows semiparametric estimation. The implemented algorithm used to
compute model estimates is described in
Sørensen et al. (2023)
,
and is an extension of the algorithm used for fitting generalized linear
mixed models by the <code>lme4</code> package
(Bates et al. 2015)
. The syntax used to
define factor structures is based on that used by the <code>PLmixed</code>
package, which is detailed in
Rockwood and Jeon (2019)
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">galamm</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>  family_mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  load.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lambda <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  factor_interactions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"na.action"</span><span class="op">)</span>,</span>
<span>  start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="galamm_control.html">galamm_control</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A formula specifying the model. Smooth terms are defined in
the style of the <code>mgcv</code> and <code>gamm4</code> packages, see
(Wood 2017)
 for an
introduction. Random effects are specified using <code>lme4</code> syntax, which
is described in detail in
(Bates et al. 2015)
. Factor loadings
will also be part of the model formula, and is based on the syntax of the
<code>PLmixed</code> package
(Rockwood and Jeon 2019)
.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>An optional formula object specifying an expression for the
residual variance. Defaults to <code>NULL</code>, corresponding to homoscedastic
errors. The formula is defined in <code>lme4</code> style; see vignettes and
examples for details.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data.frame containing all the variables specified by the model
formula, with the exception of factor loadings.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>A a list or character vector containing one or more model
families. For each element in <code>family</code> there should be a corresponding
element in <code>family_mapping</code> specifying which elements of the response
are conditionally distributed according to the given family. Currently
family can be one of <code>gaussian</code>, <code>binomial</code>, and <code>poisson</code>,
and only canonical link functions are supported. The family arguments can
either be provided as character values, e.g., <code>c("gaussian",
  "poisson")</code> or <code>list("gaussian", "poisson")</code>, as function names, e.g.,
<code>c(gaussian, poisson)</code> or <code>list(gaussian, poisson)</code>, or as
function calls, e.g., <code>list(gaussian(), poisson())</code>. In the latter
case, they must be provided in a list, and bot as a vector. Mixing the
different ways of describing the family also works, e.g.,
<code>list("gaussian", poisson())</code>, but in this case they must be provided
in a list. When provided as character values, the argument is case
sensitive.</p></dd>


<dt id="arg-family-mapping">family_mapping<a class="anchor" aria-label="anchor" href="#arg-family-mapping"></a></dt>
<dd><p>Optional vector mapping from the elements of
<code>family</code> to rows of <code>data</code>. Defaults to <code>rep(1,
  nrow(data))</code>, which means that all observations are distributed according
to the first element of <code>family</code>. The length of <code>family_mapping</code>
must be identical to the number of observations, <code>nrow(data)</code>.</p></dd>


<dt id="arg-load-var">load.var<a class="anchor" aria-label="anchor" href="#arg-load-var"></a></dt>
<dd><p>Optional character specifying the name of the variable in
<code>data</code> identifying what the factors load onto. Default to <code>NULL</code>,
which means that there are no loading variables. Argument is case
sensitive.</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>Optional factor loading matrix. Numerical values indicate that
the given value is fixed, while <code>NA</code> means that the entry is a
parameter to be estimated. Numerical values can only take the values 0 or</p><ol><li><p>The number of columns of <code>lambda</code> must be identical to the number
of elements in <code>factor</code>. Defaults to <code>NULL</code>, which means that
there is no factor loading matrix. If <code>lambda</code> is provided as a
vector, it will be converted to a <code>matrix</code> with a single column.</p></li>
</ol></dd>


<dt id="arg-factor">factor<a class="anchor" aria-label="anchor" href="#arg-factor"></a></dt>
<dd><p>Optional character vector whose \(j\)th entry corresponds to
the \(j\)th column of the corresponding matrix in <code>lambda</code>. The
number of elements in <code>factor</code> must be equal to the number of columns
in <code>lambda</code>. Defaults to <code>NULL</code>, which means that there are no
factor loadings. Argument is case sensitive.</p></dd>


<dt id="arg-factor-interactions">factor_interactions<a class="anchor" aria-label="anchor" href="#arg-factor-interactions"></a></dt>
<dd><p>Optional list of length equal to the number of
columns in <code>lambda</code>. Each list element should be a <code>formula</code>
object containing the write-hand side of a regression model, of the form
<code>~ x + z</code>. Defaults to <code>NULL</code>, which means that no factor
interactions are used.</p></dd>


<dt id="arg-na-action">na.action<a class="anchor" aria-label="anchor" href="#arg-na-action"></a></dt>
<dd><p>Character of length one specifying a function which
indicates what should happen when the data contains <code>NA</code>s. The
defaults is set to the <code>na.action</code> setting of <code>options</code>, which
can be seen with <code>options("na.action")</code>. The other alternatives are
<code>"na.fail"</code> or <code>"na.exclude"</code>, which means that the function
fails if there as <code>NA</code>s in <code>data</code>.</p></dd>


<dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>Optional named list of starting values for parameters. Possible
names of list elements are <code>"theta"</code>, <code>"beta"</code>, <code>"lambda"</code>,
and <code>"weights"</code>, all of should be numerical vectors with starting
values. Default to <code>NULL</code>, which means that some relatively sensible
defaults are used. Names of parameters must be given in all lower case.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>Optional control object for the optimization procedure of
class <code>galamm_control</code> resulting from calling
<code><a href="galamm_control.html">galamm_control</a></code>. Defaults to <code>NULL</code>, which means that the
defaults of <code><a href="galamm_control.html">galamm_control</a></code> are used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A model object of class <code>galamm</code>, containing the following
elements:</p><ul><li><p><code>call</code> the matched call used when fitting the model.</p></li>
<li><p><code>random_effects</code> a list containing the following two elements:</p><ul><li><p><code>b</code> random effects in original parametrization.</p></li>
<li><p><code>u</code> random effects standardized to have identity covariance matrix.</p></li>
</ul></li>
<li><p><code>model</code> a list with various elements related to the model setup and
fit:</p><ul><li><p><code>deviance</code> deviance of final model.</p></li>
<li><p><code>deviance_residuals</code> deviance residuals of the final model.</p></li>
<li><p><code>df</code> degrees of freedom of model.</p></li>
<li><p><code>family</code> a list of one or more family objects, as specified in the
<code>family</code> arguments to <code>galamm</code>.</p></li>
<li><p><code>factor_interactions</code> List of formulas specifying interactions
between latent and observed variables, as provided to the argument
<code>factor_interactions</code> to <code>galamm</code>. If not provided, it is
<code>NULL</code>.</p></li>
<li><p><code>fit</code> a numeric vector with fitted values.</p></li>
<li><p><code>fit_population</code> a numeric vector with fitted values excluding
random effects.</p></li>
<li><p><code>hessian</code> Hessian matrix of final model, i.e., the second
derivative of the log-likelihood with respect to all model parameters.</p></li>
<li><p><code>lmod</code> Linear model object returned by <code><a href="https://rdrr.io/pkg/lme4/man/modular.html" class="external-link">lme4::lFormula</a></code>, which
is used internally for setting up the models.</p></li>
<li><p><code>loglik</code> Log-likelihood of final model.</p></li>
<li><p><code>n</code> Number of observations.</p></li>
<li><p><code>pearson_residual</code> Pearson residuals of final model.</p></li>
<li><p><code>reduced_hessian</code> Logical specifying whether the full Hessian
matrix was computed, or a Hessian matrix with derivatives only with respect
to beta and lambda.</p></li>
<li><p><code>response</code> A numeric vector containing the response values used when
fitting the model.</p></li>
<li><p><code>weights_object</code> Object with weights used in model fitting. Is
<code>NULL</code> when no weights were used.</p></li>
</ul></li>
<li><p><code>parameters</code> A list object with model parameters and related
information:</p><ul><li><p><code>beta_inds</code> Integer vector specifying the indices of fixed
regression coefficients among the estimated model parameters.</p></li>
<li><p><code>dispersion_parameter</code> One or more dispersion parameters of the
final model.</p></li>
<li><p><code>lambda_dummy</code> Dummy matrix of factor loadings, which shows the
structure of the loading matrix that was supplied in the <code>lambda</code>
arguments.</p></li>
<li><p><code>lambda_inds</code> Integer vector specifying the indices of factor
loadings among the estimated model parameters.</p></li>
<li><p><code>lambda_interaction_inds</code> Integer vector specifying the indices
of regression coefficients for interactions between latent and observed
variables.</p></li>
<li><p><code>parameter_estimates</code> Numeric vector of final parameter estimates.</p></li>
<li><p><code>parameter_names</code> Names of all parameters estimates.</p></li>
<li><p><code>theta_inds</code> Integer vector specifying the indices of variance
components among the estimated model parameters. Technically these are the
entries of the Cholesky decomposition of the covariance matrix.</p></li>
<li><p><code>weights_inds</code> Integer vector specifying the indices of estimated
weights (used in heteroscedastic Gaussian models) among the estimated model
parameters.</p></li>
</ul></li>
<li><p><code>gam</code> List containing information about smooth terms in the model.
If no smooth terms are contained in the model, then it is a list of length
zero.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bates DM, Mächler M, Bolker B, Walker S (2015).
“Fitting Linear Mixed-Effects Models Using Lme4.”
<em>Journal of Statistical Software</em>, <b>67</b>(1), 1–48.
ISSN 1548-7660, <a href="https://doi.org/10.18637/jss.v067.i01" class="external-link">doi:10.18637/jss.v067.i01</a>
.<br><br> Breslow NE, Clayton DG (1993).
“Approximate Inference in Generalized Linear Mixed Models.”
<em>Journal of the American Statistical Association</em>, <b>88</b>(421), 9–25.
ISSN 0162-1459, <a href="https://doi.org/10.2307/2290687" class="external-link">doi:10.2307/2290687</a>
.<br><br> Harville DA (1977).
“Maximum Likelihood Approaches to Variance Component Estimation and to Related Problems.”
<em>Journal of the American Statistical Association</em>, <b>72</b>(358), 320–338.
ISSN 0162-1459, <a href="https://doi.org/10.2307/2286796" class="external-link">doi:10.2307/2286796</a>
.<br><br> Henderson CR (1975).
“Best Linear Unbiased Estimation and Prediction under a Selection Model.”
<em>Biometrics</em>, <b>31</b>(2), 423–447.
ISSN 0006-341X, <a href="https://doi.org/10.2307/2529430" class="external-link">doi:10.2307/2529430</a>
.<br><br> Laird NM, Ware JH (1982).
“Random-Effects Models for Longitudinal Data.”
<em>Biometrics</em>, <b>38</b>(4), 963–974.
ISSN 0006-341X, <a href="https://doi.org/10.2307/2529876" class="external-link">doi:10.2307/2529876</a>
.<br><br> Rabe-Hesketh S, Skrondal A, Pickles A (2004).
“Generalized Multilevel Structural Equation Modeling.”
<em>Psychometrika</em>, <b>69</b>(2), 167–190.
ISSN 1860-0980, <a href="https://doi.org/10.1007/BF02295939" class="external-link">doi:10.1007/BF02295939</a>
.<br><br> Rockwood NJ, Jeon M (2019).
“Estimating Complex Measurement and Growth Models Using the R Package PLmixed.”
<em>Multivariate Behavioral Research</em>, <b>54</b>(2), 288–306.
ISSN 0027-3171, <a href="https://doi.org/10.1080/00273171.2018.1516541" class="external-link">doi:10.1080/00273171.2018.1516541</a>
.<br><br> Skrondal A, Rabe-Hesketh S (2004).
<em>Generalized Latent Variable Modeling</em>,  Interdisciplinary Statistics Series.
Chapman and Hall/CRC, Boca Raton, Florida.<br><br> Sørensen Ø, Fjell AM, Walhovd KB (2023).
“Longitudinal Modeling of Age-Dependent Latent Traits with Generalized Additive Latent and Mixed Models.”
<em>Psychometrika</em>, <b>88</b>(2), 456–486.
ISSN 1860-0980, <a href="https://doi.org/10.1007/s11336-023-09910-z" class="external-link">doi:10.1007/s11336-023-09910-z</a>
.<br><br> Wood SN (2017).
<em>Generalized Additive Models: An Introduction with R</em>, 2 edition.
Chapman and Hall/CRC.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other modeling functions:
<code><a href="sl.html">s</a>()</code>,
<code><a href="t2l.html">t2</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Mixed response model ------------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The mresp dataset contains a mix of binomial and Gaussian responses.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We need to estimate a factor loading which scales the two response types.</span></span></span>
<span class="r-in"><span><span class="va">loading_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define mapping to families.</span></span></span>
<span class="r-in"><span><span class="va">families</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gaussian</span>, <span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">family_mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">mresp</span><span class="op">$</span><span class="va">itemgroup</span> <span class="op">==</span> <span class="st">"a"</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the model</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">galamm</span><span class="op">(</span></span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">level</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">mresp</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="va">families</span>,</span></span>
<span class="r-in"><span>  family_mapping <span class="op">=</span> <span class="va">family_mapping</span>,</span></span>
<span class="r-in"><span>  factor <span class="op">=</span> <span class="st">"level"</span>,</span></span>
<span class="r-in"><span>  load.var <span class="op">=</span> <span class="st">"itemgroup"</span>,</span></span>
<span class="r-in"><span>  lambda <span class="op">=</span> <span class="va">loading_matrix</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Summary information</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GALAMM fit by maximum marginal likelihood.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: y ~ x + (0 + level | id)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Data: mresp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      AIC      BIC   logLik deviance df.resid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   9248.7   9280.2  -4619.3   3633.1     3995 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lambda:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         level      SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda1 1.000       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda2 1.095 0.09982</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups Name  Variance Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  id     level 1.05     1.025   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 4000, groups:  id, 1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value  Pr(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    0.041    0.05803  0.7065 4.799e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x              0.971    0.08594 11.2994 1.321e-29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Heteroscedastic model -----------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Residuals allowed to differ according to the item variable</span></span></span>
<span class="r-in"><span><span class="co"># We also set the initial value of the random intercept standard deviation</span></span></span>
<span class="r-in"><span><span class="co"># to 1</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">galamm</span><span class="op">(</span></span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>, weights <span class="op">=</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">item</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">hsced</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GALAMM fit by maximum marginal likelihood.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: y ~ x + (1 | id)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Data: hsced</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weights: ~(1 | item)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      AIC      BIC   logLik deviance df.resid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4126.3   4151.7  -2058.1   4116.3     1195 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Scaled residuals: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -5.6545 -0.7105  0.0286  0.6827  4.3261 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups   Name        Variance Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  id       (Intercept) 0.9880   0.9940  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Residual             0.9597   0.9796  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 1200, groups:  id, 200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance function:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1     2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.000 1.995 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value  Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.1289     0.0992   1.299 1.938e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             0.7062     0.1213   5.822 5.819e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generalized additive mixed model with factor structures -------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The cognition dataset contains simulated measurements of three latent</span></span></span>
<span class="r-in"><span><span class="co"># time-dependent processes, corresponding to individuals' abilities in</span></span></span>
<span class="r-in"><span><span class="co"># cognitive domains. We focus here on the first domain, and take a single</span></span></span>
<span class="r-in"><span><span class="co"># random timepoint per person:</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">cognition</span>, <span class="va">domain</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">dat</span>, f <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">dat</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">timepoint</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">timepoint</span>, <span class="fl">1</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">item</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># At each timepoint there are three items measuring ability in the cognitive</span></span></span>
<span class="r-in"><span><span class="co"># domain. We fix the factor loading for the first measurement to one, and</span></span></span>
<span class="r-in"><span><span class="co"># estimate the remaining two. This is specified in the loading matrix.</span></span></span>
<span class="r-in"><span><span class="va">loading_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can now estimate the model.</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">galamm</span><span class="op">(</span></span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">item</span> <span class="op">+</span> <span class="fu"><a href="sl.html">sl</a></span><span class="op">(</span><span class="va">x</span>, factor <span class="op">=</span> <span class="st">"loading"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">loading</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>  load.var <span class="op">=</span> <span class="st">"item"</span>,</span></span>
<span class="r-in"><span>  lambda <span class="op">=</span> <span class="va">loading_matrix</span>,</span></span>
<span class="r-in"><span>  factor <span class="op">=</span> <span class="st">"loading"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can plot the estimated smooth term</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_smooth.galamm.html">plot_smooth</a></span><span class="op">(</span><span class="va">mod</span>, shade <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="galamm-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Interaction between observed and latent covariates ------------------------</span></span></span>
<span class="r-in"><span><span class="co"># Define the loading matrix</span></span></span>
<span class="r-in"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define the regression functions, one for each row in the loading matrix</span></span></span>
<span class="r-in"><span><span class="va">factor_interactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the model</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">galamm</span><span class="op">(</span></span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">type</span> <span class="op">+</span> <span class="va">x</span><span class="op">:</span><span class="va">response</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">loading</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">latent_covariates</span>,</span></span>
<span class="r-in"><span>  load.var <span class="op">=</span> <span class="st">"type"</span>,</span></span>
<span class="r-in"><span>  lambda <span class="op">=</span> <span class="va">lambda</span>,</span></span>
<span class="r-in"><span>  factor <span class="op">=</span> <span class="st">"loading"</span>,</span></span>
<span class="r-in"><span>  factor_interactions <span class="op">=</span> <span class="va">factor_interactions</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The summary output now include an interaction between the latent variable</span></span></span>
<span class="r-in"><span><span class="co"># and x, for predicting the third element in "type"</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GALAMM fit by maximum marginal likelihood.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: y ~ type + x:response + (0 + loading | id)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Data: latent_covariates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      AIC      BIC   logLik deviance df.resid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    138.3    177.9    -60.2    120.3      591 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Scaled residuals: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -2.2033 -0.5251 -0.0273  0.5146  3.5029 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lambda:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           loading      SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda1    1.0000       .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda2    1.3034 0.01268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda3   -0.3183 0.01604</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda4_x  0.2331 0.02873</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups   Name    Variance Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  id       loading 0.98175  0.9908  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Residual         0.01164  0.1079  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 600, groups:  id, 200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Estimate Std. Error  t value  Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)      -0.010589    0.07048 -0.15024 8.806e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> typemeasurement2 -0.002173    0.02384 -0.09116 9.274e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> typeresponse      0.034005    0.09417  0.36109 7.180e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x:response        0.462507    0.03300 14.01556 1.252e-44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Øystein Sørensen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

