---
output: github_document
bibliography: inst/references.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# The galamm package for fitting generalized additive latent and mixed models

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![R-CMD-check](https://github.com/LCBC-UiO/galamm/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/LCBC-UiO/galamm/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/LCBC-UiO/galamm/branch/main/graph/badge.svg)](https://app.codecov.io/gh/LCBC-UiO/galamm?branch=main)
<!-- badges: end -->

galamm is an R package for estimating generalized additive latent and mixed models (GALAMM). The model framework was introduced by @sorensenLongitudinalModelingAgeDependent2023, which is available with open access from the [publisher's website](https://doi.org/10.1007/s11336-023-09910-z). It is an extension of the GLLAMM framework for multilevel latent variable modeling detailed in @rabe-heskethGeneralizedMultilevelStructural2004. 

The package allows maximum likelihood estimation of complex multilevel models (aka mixed models). In particular, models with any combination of the following features are supported, with links to the corresponding vignettes:

- [Linear mixed models with factor structures](https://lcbc-uio.github.io/galamm/articles/lmm_factor.html).
- [Generalized linear mixed models with factor structures](https://lcbc-uio.github.io/galamm/articles/glmm_factor.html).
- [Linear mixed models with heteroscedastic residuals](https://lcbc-uio.github.io/galamm/articles/lmm_heteroscedastic.html).
- [Mixed models with mixed response types](https://lcbc-uio.github.io/galamm/articles/mixed_response.html).
- Generalized additive mixed models with factor structures.

The package uses an interface similar to [PLmixed](https://cran.r-project.org/package=PLmixed) [@rockwoodEstimatingComplexMeasurement2019], which fits generalized linear mixed models with factor structures. However, for the types of models supported by both PLmixed and galamm, galamm is usually considerably faster. The syntax for defining models is close to that of [lme4](https://cran.r-project.org/package=lme4) [@batesFittingLinearMixedEffects2015]. If your model can be estimated with lme4, then you should definitely prefer that package, as it's very mature, and also likely to be faster. galamm should however give results very similar to lme4.

The core computations in galamm are done using sparse matrix methods supported by [RcppEigen](https://cran.r-project.org/package=RcppEigen) [@batesFastElegantNumerical2013] and automatic differentiation using the C++ library [autodiff](https://autodiff.github.io/) [@lealAutodiffModernFast2018]. The [optimization vignette](https://lcbc-uio.github.io/galamm/articles/optimization.html) provides more details.




## Installation

You can install the development version of galamm from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("LCBC-UiO/galamm")
```
## Example

```{r}
library(galamm)
```

The dataframe `mresp` contains simulated data with mixed response types.

```{r}
head(mresp)
```

Responses in rows with `itemgroup = "a"` are normally distributed while those in rows with `itemgroup = "b"` are binomially distributed. For a given subject, identified by the `id` variable, both responses are associated with the same underlying latent variable. We hence need to model this process jointly, and the model is set up as follows:


```{r, message=FALSE}
mixed_resp <- galamm(
  formula = y ~ x + (0 + loading | id),
  data = mresp,
  family = c(gaussian, binomial),
  family_mapping = ifelse(mresp$itemgroup == "a", 1L, 2L),
  load.var = "itemgroup",
  lambda = list(matrix(c(1, NA), ncol = 1)),
  factor = list("loading")
)
```

The summary function gives some information about the model fit.

```{r}
summary(mixed_resp)
```



## References
